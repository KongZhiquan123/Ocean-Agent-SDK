# 海洋数据预处理测试报告

生成时间: 2026/2/2 16:04:15

## 总体概览

| 指标 | 数量 |
|------|------|
| 总计 | 17 |
| ✅ 通过 | 15 |
| ❌ 失败 | 2 |
| ⚠️ 错误 | 0 |
| **通过率** | **88%** |

## 分类统计

| 测试类型 | 总数 | 通过 | 失败 | 通过率 |
|----------|------|------|------|--------|
| 🔬 数据质量 | 8 | 8 | 0 | 100% |
| 💬 表达方式 | 5 | 4 | 1 | 80% |
| ❓ 模糊请求 | 4 | 3 | 1 | 75% |

## 详细结果

### 🔬 数据质量测试

#### ✅ [DQ-001] NaN 数据检测

- **文件**: bad_nan_in_data.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 74.2s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 请帮我预处理海洋数据： - 数据目录: /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases - 文件匹配: bad_nan_in_data.nc - 研究变量: uo, vo - 输出目录: /tmp/ocean_badcase_test/nan_test
- 🤖 Agent:   我来帮您预处理海洋数据。我将使用完整的预处理流程来处理这个数据集。  遇到了错误。让我先检查一下这个数据文件的具体情况：  发现数据存在严重问题：  **数据质量问题：** - uo 变量包含 10,000 个 NaN 值 - uo 和 vo 都包含极大的异常值（约 9.97e+36），这可能是数据损坏或特殊填充值 - 这些异常值导致统计信息计算出 Infinity，进而导致 JSON 序列化失败  让我尝试使用 `allow_nan=true` 参数来处理这个数据：  问题在于数据中的极大异常值导致统计信息计算出 Infinity，使得 JSON 序列化失败。让我先清理数据，然后再进行预...

</details>

---

#### ✅ [DQ-002] Inf 数据检测

- **文件**: bad_inf_in_data.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 139.5s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 帮我处理一下这个海洋数据文件 bad_inf_in_data.nc，在 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases 目录下，变量是 uo 和 vo，输出到 /tmp/ocean_badcase_test/inf_test
- 🤖 Agent:   我来帮您处理这个海洋数据文件。根据文件名 `bad_inf_in_data.nc`，这个文件可能包含无穷大值（Inf）。让我先运行预处理流程看看情况。  看起来预处理工具在处理这个文件时遇到了 JSON 解析错误，这很可能是因为数据中包含了 Inf 值。让我先检查一下这个文件的具体情况：  <thinking_mode>enabled</thinking_mode>  <thinking> 文件确实包含 Inf 值： - uo 变量有 5000 个 Inf 值（2500 个正无穷，2500 个负无穷） - vo 变量虽然没有 Inf，但有异常大的值  预处理工具默认 allow_nan=f...

</details>

---

#### ✅ [DQ-003] 坐标 NaN 检测

- **文件**: bad_coords_nan.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 24.1s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 我有个 nc 文件需要预处理，路径是 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/bad_coords_nan.nc，动态变量选 uo vo，输出到 /tmp/ocean_badcase_test/coords_nan
- 🤖 Agent:   我来帮您预处理这个 NC 文件。我将使用海洋数据预处理工具执行完整的流程。  预处理失败了。检测到一个关键问题：  **错误信息**： - 坐标变量 'latitude' 包含非法值：有 **2 个 NaN 值** - 默认情况下，坐标变量不允许包含 NaN 或 Inf 值  **文件信息**： - 找到 1 个 NC 文件：`bad_coords_nan.nc` - 动态变量：uo, vo（形状：[2, 1, 2041, 4320]，即 [时间, 深度, 纬度, 经度]） - 数据类型：int16  **解决方案**：  您有两个选择：  1. **允许 NaN 值**（用于测试或特殊场...

</details>

---

#### ✅ [DQ-004] 零长度维度检测

- **文件**: bad_zero_dimension.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 30.2s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 预处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/bad_zero_dimension.nc 这个文件，uo vo 是动态变量，结果放 /tmp/ocean_badcase_test/zero_dim
- 🤖 Agent:   我来帮您预处理这个海洋数据文件。我将使用完整的预处理流程来处理这个文件。<thinking_mode>预处理失败了，原因是数据文件中的时间维度长度为0（shape=[0,1,2041,4320]）。这是一个"坏案例"文件，时间维度是空的，导致无法提取任何数据。  从错误信息可以看到： 1. Step A 和 Step B 都通过了，成功识别了变量结构 2. Step C 转换失败，因为检测到零长度维度 3. 具体错误：    - "动态变量 'uo' 有零长度维度，位置: [0]"    - "动态变量 'vo' 有零长度维度，位置: [0]"  这个文件确实是一个"bad case"（从...

</details>

---

#### ✅ [DQ-005] 非标准维度(3D)检测

- **文件**: bad_no_time_dim.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 128.1s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 处理海洋流速数据 bad_no_time_dim.nc，目录 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases，研究 uo vo 变量，输出 /tmp/ocean_badcase_test/no_time
- 🤖 Agent:   遇到了数据检查错误。让我先检查一下这个文件的具体情况：  让我使用 Python 来检查这个文件：  我发现问题了。这个文件没有时间维度（time dimension），变量形状是 `(depth, latitude, longitude)` 而不是预期的 `(time, height, width)` 或 `(time, depth, height, width)`。这是一个特殊的"bad case"。  让我尝试使用单步工具来诊断：  让我更详细地检查数据统计信息：  我发现了问题所在。这个文件有两个主要问题：  ## 问题诊断  1. **缺少时间维度**：文件中的 `uo` 和 `...

</details>

---

#### ✅ [DQ-006] 5D数据检测

- **文件**: bad_extra_dim.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 1
- **耗时**: 138.4s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases 下有个 bad_extra_dim.nc，帮我预处理成 npy，变量 uo vo，输出到 /tmp/ocean_badcase_test/extra_dim
- 🤖 Agent:   我来帮你处理这个 NC 文件。首先让我检查一下文件是否存在，然后进行预处理。  我发现问题了！这个文件包含了额外的维度。让我检查一下文件的详细结构：  让我用 Python 检查一下这个文件的详细结构：  我发现问题了！这个文件包含了一个额外的 `ensemble` 维度（集合预报），形状是 `(time=2, ensemble=3, depth=1, latitude=2041, longitude=4320)`，但预处理工具期望的是 3D 或 4D 格式。  我需要先处理这个额外的维度。让我创建一个脚本来处理：  让我先检查当前工作目录：  现在让我运行这个脚本来处理数据：  太好了！...

</details>

---

#### ✅ [DQ-007] 缺少变量检测

- **文件**: bad_missing_variable.nc
- **期望**: error
- **实际**: error
- **状态**: PASS
- **轮次**: 2
- **耗时**: 46.8s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 请预处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/bad_missing_variable.nc，动态变量 uo vo，输出 /tmp/ocean_badcase_test/missing_var
- 🤖 Agent:   我将为您预处理这个海洋数据文件。让我使用 ocean_preprocess_full 工具来执行完整的预处理流程。  预处理失败了。根据检测结果：  ## 问题分析  文件 `bad_missing_variable.nc` 中**缺少变量 `vo`**：  ### Step A - 数据检查结果： - ✅ 找到文件：`bad_missing_variable.nc` - ✅ 找到变量 `uo`：   - 形状：[2, 1, 2041, 4320] (time, depth, latitude, longitude)   - 类型：int16   - 统计：min=-32767, max=...
**第 2 轮**

- 👤 用户: 用默认的就行
- 🤖 Agent:   好的，我将只处理文件中存在的 `uo` 变量。  ✅ **预处理成功完成！**  ## 处理结果  ### Step A - 数据检查 - 文件：`bad_missing_variable.nc` - 找到动态变量：`uo`   - 形状：[2, 1, 2041, 4320] (时间=2, 深度=1, 高度=2041, 宽度=4320)   - 数据类型：int16  ### Step B - 张量验证 - ✅ 张量约定验证通过 - 解释：[T=2, D=1, H=2041, W=4320]  ### Step C - 转换和验证 - ✅ 已保存文件：`/tmp/ocean_badcase...

</details>

---

#### ✅ [DQ-008] 正常数据（应该成功）

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 31.3s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 帮我预处理海洋数据 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，动态变量是 uo 和 vo，输出到 /tmp/ocean_badcase_test/good_data
- 🤖 Agent:   我来帮您预处理海洋数据。我将使用完整的预处理流程来处理您的数据。  ✅ **海洋数据预处理完成！**  ## 处理结果摘要  ### 📊 数据信息 - **输入文件**: `good_normal_data.nc` - **动态变量**: `uo`, `vo` - **数据形状**: [T=2, D=1, H=2041, W=4320]   - 时间步: 2   - 深度层: 1   - 空间分辨率: 2041 × 4320  ### ✅ 输出文件 已成功保存到 `/tmp/ocean_badcase_test/good_data/target_variables/`: 1. **uo....

</details>

---

### 💬 表达方式测试

#### ✅ [EV-001] 口语化请求

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 27.3s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 嗨，我这有个海洋数据文件要处理一下，在 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，想要分析 uo 和 vo 这两个变量，处理完放到 /tmp/ocean_badcase_test/casual_test 吧
- 🤖 Agent:   你好！我来帮你处理这个海洋数据文件。  太好了！数据处理完成！✅  ## 处理结果总结  ### 📊 数据信息 - **输入文件**：good_normal_data.nc - **研究变量**：uo（东向流速）、vo（北向流速） - **数据形状**：[时间=2, 深度=1, 纬度=2041, 经度=4320] - **数据类型**：int16  ### 📁 输出文件 已成功保存到 `/tmp/ocean_badcase_test/casual_test/target_variables/`： 1. **uo.npy** - 东向流速数据 2. **vo.npy** - 北向流速数据...

</details>

---

#### ❌ [EV-002] 英文夹杂请求

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: error
- **状态**: FAIL
- **轮次**: 1
- **耗时**: 37.4s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: help me preprocess 海洋数据 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，variables 是 uo vo，output 到 /tmp/ocean_badcase_test/mixed_lang
- 🤖 Agent: <thinking_mode>The ocean preprocessing encountered an error during Step C (conversion to NPY format). The error message shows "corrupted size vs. prev_size while consolidating" followed by "Aborted (core dumped)", which suggests a memory corruption issue.  Looking at the data: - The NC folder contai...

</details>

---

#### ✅ [EV-003] 简短命令式

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 27.2s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 预处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc uo vo /tmp/ocean_badcase_test/short_cmd
- 🤖 Agent:   我将帮您预处理海洋数据。让我执行完整的预处理流程。  ✅ **预处理完成！**  ## 处理结果  ### 📊 数据概览 - **输入文件**: `good_normal_data.nc` (1个文件) - **研究变量**: `uo`, `vo` - **数据形状**: [T=2, D=1, H=2041, W=4320] - **数据类型**: int16  ### 📁 输出文件 已成功保存到 `/tmp/ocean_badcase_test/short_cmd/target_variables/`: 1. **uo.npy** - 形状 [2, 1, 2041, 4320] 2....

</details>

---

#### ✅ [EV-004] 详细专业请求

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 50.2s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 我需要对 NetCDF 格式的海洋环流数据进行预处理。源数据文件位于 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，包含东向流速(uo)和北向流速(vo)两个动态变量。请将其转换为 NumPy 数组格式，输出至 /tmp/ocean_badcase_test/professional 目录。
- 🤖 Agent:   <thinking> 用户提供了一个具体的 NC 文件路径，但 ocean_preprocess_full 工具需要的是目录路径（nc_folder）。我需要：  1. 先检查文件是否存在 2. 确定文件所在目录 3. 调用 ocean_preprocess_full 工具  文件路径是：`/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc` 所在目录应该是：`/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases`  用户明确指定了动态变量：uo 和 vo 输出目录：`/t...

</details>

---

#### ✅ [EV-005] 带错别字请求

- **文件**: good_normal_data.nc
- **期望**: pass
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 40.1s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 帮我与处理下海样数据 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，边量 uo vo，输入到 /tmp/ocean_badcase_test/typo_test
- 🤖 Agent:   <thinking> 用户要求预处理海洋数据： - 输入文件：/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc - 研究变量：uo, vo - 输出目录：/tmp/ocean_badcase_test/typo_test  根据海洋数据预处理注意事项，我应该： 1. 首次调用 ocean_preprocess_full，只提供必需参数 2. 如果返回 awaiting_confirmation，向用户展示检测到的变量并询问确认 3. 用户确认后，使用完整参数重新调用  注意：nc_folder 参数需要的是目...

</details>

---

### ❓ 模糊请求测试

#### ❌ [VR-001] 没有指定变量

- **文件**: good_normal_data.nc
- **期望**: clarify
- **实际**: pass
- **状态**: FAIL
- **轮次**: 1
- **耗时**: 57.8s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 帮我预处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc 这个海洋数据文件
- 🤖 Agent:   ✅ **预处理完成！**  我已成功处理了您的海洋数据文件。以下是处理结果：  ## 📊 数据概览 - **输入文件**: `/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc` - **数据源**: MERCATOR GLORYS12V1 (全球海洋物理分析) - **时间步数**: 2 - **空间分辨率**: 2041 × 4320 (纬度 × 经度) - **深度层数**: 1  ## 🎯 处理的变量 1. **uo** (东向流速): 形状 [2, 1, 2041, 4320] 2. **vo**...

</details>

---

#### ✅ [VR-002] 没有指定输出目录

- **文件**: good_normal_data.nc
- **期望**: clarify
- **实际**: pass
- **状态**: PASS
- **轮次**: 1
- **耗时**: 38.9s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，变量是 uo vo
- 🤖 Agent:   <thinking> 用户提供了一个具体的 NC 文件路径和研究变量。我需要：  1. 确认文件路径和目录结构 2. 使用 ocean_preprocess_full 工具处理数据 3. 首次调用只提供必需参数  文件路径：`/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc` - nc_folder 应该是：`/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases` - dyn_vars：["uo", "vo"] - output_base：我需要设置一个输出目录  让我先...

</details>

---

#### ✅ [VR-003] 只说要处理海洋数据

- **文件**: (无文件)
- **期望**: clarify
- **实际**: clarify
- **状态**: PASS
- **轮次**: 3
- **耗时**: 64.8s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 我想处理一些海洋数据
- 🤖 Agent:   <thinking> 用户说想处理一些海洋数据。根据指导原则，当用户需要进行海洋数据预处理时，我应该： 1. 先加载 ocean-preprocess 技能获取完整流程指导 2. 了解用户的具体需求  我应该先询问用户的具体情况，比如： - 数据文件在哪里 - 想要处理什么类型的数据 - 目标是什么  同时，我可以先加载 ocean-preprocess 技能，这样可以为用户提供更专业的指导。 </thinking>  您好！我可以帮您处理海洋数据。让我先加载海洋数据预处理技能，然后了解您的具体需求。  好的！我已经加载了海洋数据预处理技能。这个工具可以帮您将 NC 格式的海洋数据转换为 ...
**第 2 轮**

- 👤 用户: 文件在 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc
- 🤖 Agent:   好的！让我先检查这个文件并查看它包含哪些变量。  让我用 Python 查看这个 NC 文件的内容：  太好了！我已经查看了这个文件。让我为您总结一下：  ## 📊 数据文件信息  **文件大小**: 68 MB  **维度**: - `time`: 2 个时间步 - `depth`: 1 个深度层 - `latitude`: 2041 - `longitude`: 4320  **数据变量**（动态变量）: - `uo` - 东向流速，shape: (2, 1, 2041, 4320) - `vo` - 北向流速，shape: (2, 1, 2041, 4320)  **坐标变量**:...
**第 3 轮**

- 👤 用户: uo vo
- 🤖 Agent:   好的！您要处理 **uo** 和 **vo** 两个变量。  现在还需要确认两个信息：  ## 1. 输出目录 处理后的 NPY 文件保存到哪里？我建议： - `/home/lz/Ocean-Agent-SDK/work_ocean/processed/`   或者您可以指定其他路径。  ## 2. 静态文件（可选） 是否有包含以下信息的静态文件： - 掩码（mask_rho, mask_u, mask_v 等） - 地形深度（h, bathymetry） - 网格信息（lon_rho, lat_rho, angle 等）  如果没有静态文件，我们就只处理动态变量 uo 和 vo。  --...

</details>

---

#### ✅ [VR-004] 不确定哪些是动态变量

- **文件**: good_normal_data.nc
- **期望**: clarify
- **实际**: error
- **状态**: PASS
- **轮次**: 2
- **耗时**: 52.6s


<details>
<summary>对话记录</summary>

**第 1 轮**

- 👤 用户: 预处理 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc，我不太确定哪些是动态变量，你帮我看看
- 🤖 Agent:   <thinking> 用户提供了一个NC文件路径，想要预处理但不确定哪些是动态变量。我需要：  1. 使用 ocean_inspect_data 工具来检查数据 2. 该工具会自动分类动态/静态/掩码变量 3. 然后向用户展示结果并请求确认  参数： - nc_folder: 需要提供目录路径，但用户给的是文件路径 /home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/good_normal_data.nc - 我需要提取目录部分：/home/lz/Ocean-Agent-SDK/work_ocean/bad_cases/ - dyn_file_pat...
**第 2 轮**

- 👤 用户: 用 uo 和 vo
- 🤖 Agent:   好的！我现在开始预处理，使用 `uo` 和 `vo` 作为研究变量。  ✅ **预处理完成！**  ## 📦 处理结果  ### Step A: 数据检查 - ✅ 找到 1 个 NC 文件 - ✅ 识别出 2 个动态变量：uo, vo  ### Step B: 张量约定验证 - ✅ **uo**: [T=2, D=1, H=2041, W=4320] - 符合 [T, D, H, W] 约定 - ✅ **vo**: [T=2, D=1, H=2041, W=4320] - 符合 [T, D, H, W] 约定  ### Step C: NPY转换与验证 - ✅ 已保存 2 个文件到输出目...

</details>

---

