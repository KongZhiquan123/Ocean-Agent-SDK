---
name: ocean-preprocess
description: æµ·æ´‹æ•°æ®é¢„å¤„ç†æŠ€èƒ½ - ä¸“ç”¨äºè¶…åˆ†è¾¨ç‡åœºæ™¯çš„NCåˆ°NPYæ•°æ®æ ¼å¼è½¬æ¢
version: 3.2.0
author: kongzhiquan
contributors: leizheng
last_modified: 2026-02-05
---

<!--
Changelog:
  - 2026-02-05 kongzhiquan: v3.2.0
    - é‡æ„æ–‡æ¡£ç»“æ„ï¼šæ ¸å¿ƒå†…å®¹ç²¾ç®€è‡³ ~150 è¡Œ
    - è¯¦ç»†æ–‡æ¡£ç§»è‡³ references/ ç›®å½•
    - æ–°å¢ references/workflow-detail.md, examples.md, parameters.md, errors.md, warnings.md
  - 2026-02-05 kongzhiquan: v3.1.0 - çŠ¶æ€æœºæ¶æ„ã€Token æœºåˆ¶ã€åŒºåŸŸè£å‰ª
  - 2026-02-04 leizheng: v2.9.0 - 4 é˜¶æ®µå¼ºåˆ¶åœæ­¢ç‚¹
  - 2026-02-04 leizheng: v2.6.0 - ç²—ç½‘æ ¼æ¨¡å¼æ”¯æŒ
-->

# æµ·æ´‹æ•°æ®é¢„å¤„ç†æŠ€èƒ½

## æ ¸å¿ƒåŸåˆ™

1. **æ•°æ®é¢„å¤„ç†å®šä¹‰**ï¼šä¸ç ´ååŸæœ‰æ•°æ®ç»“æ„ï¼Œä¸åšæ ‡å‡†åŒ–ï¼Œåªåšæ ¼å¼è½¬æ¢
2. **è­¦å‘Šä¼˜å…ˆ**ï¼šä»»ä½•è­¦å‘Šå¿…é¡»æš‚åœè¯¢é—®ç”¨æˆ·ï¼Œä¸èƒ½è‡ªåŠ¨ç»§ç»­
3. **ç¦æ­¢è‡ªåŠ¨å†³ç­–**ï¼šæ‰€æœ‰å˜é‡é€‰æ‹©ã€å‚æ•°è®¾ç½®å¿…é¡»ç”±ç”¨æˆ·ç¡®è®¤
4. **é”™è¯¯ä¸è‡ªåŠ¨é‡è¯•**ï¼šé‡åˆ°é”™è¯¯å±•ç¤ºç»™ç”¨æˆ·ï¼Œç­‰å¾…æŒ‡ç¤º

---

## å¯ç”¨å·¥å…·

| å·¥å…· | ç”¨é€” | ä½¿ç”¨æ—¶æœº |
|------|------|----------|
| `ocean_preprocess_full` | å®Œæ•´é¢„å¤„ç†æµç¨‹ | **æ¨è**ï¼šä¿¡æ¯å®Œæ•´æ—¶ä½¿ç”¨ |
| `ocean_metrics` | è´¨é‡æŒ‡æ ‡è®¡ç®— | **å¿…é¡»**ï¼šé¢„å¤„ç†åè°ƒç”¨ |
| `ocean_generate_report` | ç”ŸæˆæŠ¥å‘Š | æŒ‡æ ‡è®¡ç®—åç”Ÿæˆ |
| `ocean_inspect_data` | æŸ¥çœ‹æ•°æ®å˜é‡ | ç”¨æˆ·åªæƒ³äº†è§£æ•°æ®æ—¶ |

---

## 4 é˜¶æ®µå¼ºåˆ¶ç¡®è®¤æµç¨‹

å·¥å…·åœ¨æ¯ä¸ªé˜¶æ®µ**å¼ºåˆ¶è¿”å›**ï¼ŒAgent æ— æ³•è·³è¿‡ç¡®è®¤æ­¥éª¤ã€‚

```
è°ƒç”¨å·¥å…·ï¼ˆæ—  dyn_varsï¼‰
    â†“
â›” é˜¶æ®µ 1: awaiting_variable_selection
    â”‚  â†’ å±•ç¤ºåŠ¨æ€å˜é‡ï¼Œè¯¢é—®"æ‚¨è¦ç ”ç©¶å“ªäº›å˜é‡ï¼Ÿ"
    â†“
â›” é˜¶æ®µ 2: awaiting_static_selection
    â”‚  â†’ å±•ç¤ºé™æ€/æ©ç å˜é‡ï¼Œè¯¢é—®"éœ€è¦ä¿å­˜å“ªäº›ï¼Ÿä½¿ç”¨å“ªäº›æ©ç ï¼Ÿ"
    â†“
â›” é˜¶æ®µ 3: awaiting_parameters
    â”‚  â†’ è¯¢é—®"ä¸‹é‡‡æ ·å€æ•°ï¼Ÿæ’å€¼æ–¹æ³•ï¼Ÿåˆ’åˆ†æ¯”ä¾‹ï¼Ÿ"
    â†“
â›” é˜¶æ®µ 4: awaiting_execution
    â”‚  â†’ å±•ç¤ºå®Œæ•´å‚æ•°æ±‡æ€»ï¼Œç­‰å¾…"ç¡®è®¤æ‰§è¡Œ"
    â†“
âœ… æ‰§è¡Œå¤„ç† (Aâ†’Bâ†’Câ†’Dâ†’E)
    â†“
ğŸ“Š è°ƒç”¨ ocean_metrics è®¡ç®—æŒ‡æ ‡
    â†“
ğŸ“ è°ƒç”¨ ocean_generate_report ç”ŸæˆæŠ¥å‘Š
```

**Token æœºåˆ¶**ï¼šæ¯ä¸ªé˜¶æ®µè¿”å› `confirmation_token`ï¼Œä¸‹æ¬¡è°ƒç”¨å¿…é¡»æºå¸¦ï¼Œé˜²æ­¢è·³è¿‡é˜¶æ®µã€‚

---

## å¿«é€Ÿå‚æ•°å‚è€ƒ

### ocean_preprocess_full æ ¸å¿ƒå‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `nc_folder` | string | âœ… | æ•°æ®ç›®å½• |
| `output_base` | string | âœ… | è¾“å‡ºç›®å½• |
| `dyn_vars` | string[] | âœ… | ç ”ç©¶å˜é‡ |
| `user_confirmed` | boolean | âš ï¸ | é˜¶æ®µ 4 å¿…éœ€ |
| `confirmation_token` | string | âš ï¸ | é˜¶æ®µ 2+ å¿…éœ€ |
| `scale` | number | âš ï¸ | ä¸‹é‡‡æ ·å€æ•°ï¼ˆä¸‹é‡‡æ ·æ¨¡å¼ï¼‰ |
| `downsample_method` | string | âš ï¸ | æ’å€¼æ–¹æ³•ï¼ˆä¸‹é‡‡æ ·æ¨¡å¼ï¼‰ |
| `lr_nc_folder` | string | âš ï¸ | LR æ•°æ®ç›®å½•ï¼ˆç²—ç½‘æ ¼æ¨¡å¼ï¼‰ |

**å®Œæ•´å‚æ•°è¯´æ˜**ï¼šè§ `references/parameters.md`

---

## ç¦æ­¢è¡Œä¸ºï¼ˆæ ¸å¿ƒï¼‰

| ç±»åˆ« | ç¦æ­¢è¡Œä¸º |
|------|----------|
| **å˜é‡é€‰æ‹©** | è‡ªåŠ¨å†³å®š dyn_vars / stat_vars / mask_vars |
| **å‚æ•°å†³ç­–** | è‡ªåŠ¨å†³å®š scaleã€åˆ’åˆ†æ¯”ä¾‹ã€NaN å¤„ç†æ–¹å¼ |
| **æµç¨‹æ§åˆ¶** | è·³è¿‡ç¡®è®¤é˜¶æ®µã€è·³è¿‡è´¨é‡æŒ‡æ ‡è®¡ç®— |
| **é”™è¯¯å¤„ç†** | è‡ªåŠ¨é‡è¯•ã€è‡ªåŠ¨æ›´æ¢è·¯å¾„ |

---

## ä¸¤ç§è¶…åˆ†æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | å…³é”®å‚æ•° |
|------|------|----------|
| **ä¸‹é‡‡æ ·** | HR æ•°æ®ä¸‹é‡‡æ ·ç”Ÿæˆ LR | `scale` + `downsample_method` |
| **ç²—ç½‘æ ¼** | HR/LR æ•°æ®ç”±æ¨¡å‹åˆ†åˆ«ç”Ÿæˆ | `lr_nc_folder` |

---

## å®Œæ•´å·¥ä½œæµç¨‹

```
1. æ”¶é›†ä¿¡æ¯ â†’ æ•°æ®ç›®å½•ã€è¾“å‡ºç›®å½•
2. åˆ†ææ•°æ® â†’ ocean_inspect_data æˆ– ocean_preprocess_full
3. ç”¨æˆ·é€‰æ‹© â†’ ç ”ç©¶å˜é‡ã€é™æ€å˜é‡ã€æ©ç å˜é‡
4. ç¡®è®¤å‚æ•° â†’ scaleã€methodã€åˆ’åˆ†æ¯”ä¾‹
5. æ‰§è¡Œå‰ç¡®è®¤ â†’ å±•ç¤ºæ‰€æœ‰å‚æ•°ï¼Œç­‰å¾…"ç¡®è®¤æ‰§è¡Œ"
6. æ‰§è¡Œå¤„ç† â†’ ocean_preprocess_full (user_confirmed=true)
7. è®¡ç®—æŒ‡æ ‡ â†’ ocean_metricsï¼ˆå¿…é¡»ï¼‰
8. ç”ŸæˆæŠ¥å‘Š â†’ ocean_generate_report + Agent å¡«å†™åˆ†æ
```

**è¯¦ç»†æµç¨‹**ï¼šè§ `references/workflow-detail.md`

---

## å‚è€ƒæ–‡æ¡£ç´¢å¼•

è¯¦ç»†ä¿¡æ¯è¯·æŒ‰éœ€è¯»å–ä»¥ä¸‹æ–‡æ¡£ï¼š

| æ–‡æ¡£ | å†…å®¹ | ä½•æ—¶è¯»å– |
|------|------|----------|
| `references/workflow-detail.md` | Step 1-7 è¯¦ç»†æµç¨‹ | éœ€è¦äº†è§£å®Œæ•´æµç¨‹æ—¶ |
| `references/examples.md` | å¯¹è¯ç¤ºä¾‹ | éœ€è¦å‚è€ƒç¤ºä¾‹æ—¶ |
| `references/parameters.md` | æ‰€æœ‰å·¥å…·å‚æ•° | éœ€è¦å‚æ•°ç»†èŠ‚æ—¶ |
| `references/errors.md` | é”™è¯¯å¤„ç†æŒ‡å— | é‡åˆ°é”™è¯¯æ—¶ |
| `references/warnings.md` | è­¦å‘Šå¤„ç†æŒ‡å— | é‡åˆ°è­¦å‘Šæ—¶ |

---

## è¾“å‡ºç›®å½•ç»“æ„

```
output/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ hr/         â† é«˜åˆ†è¾¨ç‡æ•°æ®
â”‚   â””â”€â”€ lr/         â† ä½åˆ†è¾¨ç‡æ•°æ®
â”œâ”€â”€ valid/
â”œâ”€â”€ test/
â”œâ”€â”€ static_variables/
â”œâ”€â”€ visualisation_data_process/
â”œâ”€â”€ metrics_result.json
â””â”€â”€ preprocessing_report.md
```
