# 警告处理指南

> 版本: 3.2.0 | 最后更新: 2026-02-05

本文档说明预处理过程中的警告及处理方法。

---

## 警告类型一览

| 警告类型 | 说明 | 是否阻断 |
|----------|------|----------|
| `nan_detected` | 数据中存在 NaN | 需用户确认 |
| `size_not_divisible` | 尺寸不能被 scale 整除 | 需用户确认 |
| `large_dataset` | 数据量较大 | 仅提示 |
| `missing_mask` | 未检测到掩码 | 需用户确认 |
| `time_inconsistent` | 时间步不一致 | 需用户确认 |

---

## NaN 相关警告

### nan_detected

**警告信息**：`数据中检测到 NaN 值`

**详情**：
```
在以下变量中检测到 NaN 值：
- chl: 12.3% NaN (主要分布在边界区域)
- no3: 8.7% NaN

NaN 通常表示：
1. 陆地区域（被掩码覆盖）
2. 观测缺失
3. 无效数据
```

**处理选项**：
```
请选择如何处理 NaN：

1. **允许 NaN**（allow_nan: true）
   - 保留原始 NaN 值
   - 适用于有掩码的海洋数据

2. **不允许 NaN**（allow_nan: false）
   - 如果有 NaN 会报错
   - 适用于完整无缺失的数据
```

---

## 尺寸相关警告

### size_not_divisible

**警告信息**：`数据尺寸不能被下采样倍数整除`

**详情**：
```
当前数据尺寸：680 x 1440
下采样倍数：4

680 ÷ 4 = 170 ✓
1440 ÷ 4 = 360 ✓

如果不能整除，需要裁剪。
```

**处理选项**：
```
1. **自动裁剪**（crop_to_divisible: true）
   - 裁剪到最近的可整除尺寸
   - 例：683 → 680

2. **报错停止**（crop_to_divisible: false）
   - 保持原始尺寸，如果不能整除则失败
```

---

## 掩码相关警告

### missing_mask

**警告信息**：`未检测到掩码变量`

**详情**：
```
在数据中未检测到掩码变量。

对于海洋数据，掩码用于区分海洋和陆地。
如果没有掩码：
- 陆地区域可能被当作有效数据
- 可能影响训练效果
```

**处理选项**：
```
请选择：

1. **不使用掩码**
   - 将所有数据视为有效

2. **从 NaN 生成掩码**
   - 将 NaN 区域标记为无效

3. **指定掩码变量**
   - 如果知道掩码变量名，请告诉我
```

---

## 数据一致性警告

### time_inconsistent

**警告信息**：`变量时间步数不一致`

**详情**：
```
检测到时间步数不一致：
- chl: 365 时间步
- no3: 364 时间步

差异可能原因：
1. 数据缺失
2. 采样频率不同
3. 文件不完整
```

**处理**：
```
请选择：

1. **取最小公共时间步**
   - 只处理前 364 个时间步

2. **停止并检查数据**
   - 先确认数据完整性
```

---

## 性能提示

### large_dataset

**提示信息**：`数据量较大，处理可能需要较长时间`

**详情**：
```
数据统计：
- 文件数量：1000+ 个
- 单变量大小：~2GB
- 预计处理时间：较长

建议：
- 确保磁盘空间充足（需要 ~10GB）
- 处理过程中请勿中断
```

---

## 警告处理原则

1. **阻断性警告**：必须停下来让用户确认
   - nan_detected
   - size_not_divisible
   - missing_mask
   - time_inconsistent

2. **非阻断性警告**：提示后继续
   - large_dataset
   - 性能相关提示

3. **警告展示格式**：
```
⚠️ 警告：[警告类型]

【详情】
...

【处理选项】
1. ...
2. ...

请选择或告诉我您的决定。
```
