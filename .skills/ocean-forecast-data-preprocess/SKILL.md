---
name: ocean-forecast-data-preprocess
description: æµ·æ´‹é¢„æµ‹æ•°æ®é¢„å¤„ç†æŠ€èƒ½ - NC æ ¼å¼æ—¶åºæ•°æ®è½¬æ¢ä¸º NPY æ ¼å¼ï¼Œç”¨äºæ·±åº¦å­¦ä¹ é¢„æµ‹æ¨¡å‹è®­ç»ƒ
version: 1.3.0
author: Leizheng
last_modified: 2026-02-26
---

<!--
Changelog:
  - 2026-02-26 Leizheng: v1.3.0
    - æ–°å¢ ocean_forecast_stats å·¥å…·ï¼ˆper-variable ç»Ÿè®¡é‡ï¼‰
    - æ›´æ–°å¯è§†åŒ–æè¿°ï¼šæ–°å¢åˆ†å¸ƒç›´æ–¹å›¾ _distribution.png
    - å®Œæ•´å·¥ä½œæµç¨‹æ–°å¢ç»Ÿè®¡æ­¥éª¤ï¼ˆæ­¥éª¤ 7ï¼‰
    - è¾“å‡ºç›®å½•ç»“æ„è¡¥å…… data_stats.json
  - 2026-02-26 Leizheng: v1.2.0
    - è¯´æ˜ ocean_forecast_generate_report çš„ ai_analysis å‚æ•°å¿…å¡«
    - æŠ¥å‘Šç”Ÿæˆè¯´æ˜è¡¥å……æ’°å†™æŒ‡å¼•
  - 2026-02-25 Leizheng: v1.1.0
    - é‡æ„æ–‡æ¡£ç»“æ„ï¼Œå‚ç…§ ocean-preprocess SKILL.md é£æ ¼ç²¾ç®€
    - æ”¹"é¢„æŠ¥"ä¸º"é¢„æµ‹"ï¼Œå»é™¤è¶…åˆ†è¾¨ç‡å¯¹æ¯”å†…å®¹
  - 2026-02-25 Leizheng: v1.0.0
    - åˆå§‹ç‰ˆæœ¬ï¼Œ4 é˜¶æ®µå¼ºåˆ¶ç¡®è®¤æµç¨‹ï¼Œä¸¥æ ¼æ—¶é—´æ’åº
-->

# æµ·æ´‹é¢„æµ‹æ•°æ®é¢„å¤„ç†æŠ€èƒ½

## æ ¸å¿ƒåŸåˆ™

1. **åªåšæ ¼å¼è½¬æ¢**ï¼šä¸åšå½’ä¸€åŒ–ï¼Œä¸æ”¹å˜æ•°å€¼ï¼ŒNC â†’ NPY åŸæ ·è½¬å­˜
2. **æ—¶é—´ä¸¥æ ¼æ’åº**ï¼šæŒ‰ NC å†…æ—¶é—´å˜é‡å‡åºæ’åˆ—ï¼Œç»ä¸æ‰“ä¹±ï¼Œä¿éšœé¢„æµ‹åºåˆ—å› æœå…³ç³»
3. **ç¦æ­¢è‡ªåŠ¨å†³ç­–**ï¼šæ‰€æœ‰å˜é‡é€‰æ‹©ã€å‚æ•°è®¾ç½®å¿…é¡»ç”±ç”¨æˆ·ç¡®è®¤
4. **é”™è¯¯ä¸è‡ªåŠ¨é‡è¯•**ï¼šé‡åˆ°é”™è¯¯å±•ç¤ºç»™ç”¨æˆ·ï¼Œç­‰å¾…æŒ‡ç¤º

---

## å¯ç”¨å·¥å…·

| å·¥å…· | ç”¨é€” | ä½¿ç”¨æ—¶æœº |
|------|------|----------|
| `ocean_forecast_preprocess_full` | å®Œæ•´é¢„å¤„ç†æµç¨‹ | **æ¨è**ï¼šä¿¡æ¯å®Œæ•´æ—¶ä½¿ç”¨ |
| `ocean_forecast_visualize` | ç”Ÿæˆå¯è§†åŒ–å›¾ç‰‡ | é¢„å¤„ç†å®Œæˆåæ£€æŸ¥æ•°æ®è´¨é‡ |
| `ocean_forecast_stats` | è®¡ç®— per-variable ç»Ÿè®¡é‡ | å¯è§†åŒ–åï¼Œç”ŸæˆæŠ¥å‘Šå‰ï¼ˆå¯é€‰ï¼‰ |
| `ocean_forecast_generate_report` | ç”Ÿæˆé¢„å¤„ç†æŠ¥å‘Š | å¯è§†åŒ–å®Œæˆå |
| `ocean_inspect_data` | æŸ¥çœ‹ NC æ•°æ®å˜é‡ | ç”¨æˆ·åªæƒ³äº†è§£æ•°æ®ç»“æ„æ—¶ |

---

## 4 é˜¶æ®µå¼ºåˆ¶ç¡®è®¤æµç¨‹

å·¥å…·åœ¨æ¯ä¸ªé˜¶æ®µ**å¼ºåˆ¶è¿”å›**ï¼ŒAgent æ— æ³•è·³è¿‡ç¡®è®¤æ­¥éª¤ã€‚

```
è°ƒç”¨å·¥å…·ï¼ˆæ—  dyn_varsï¼‰
    â†“
â›” é˜¶æ®µ 1: awaiting_variable_selection
    â”‚  â†’ å±•ç¤ºåŠ¨æ€å˜é‡ï¼Œè¯¢é—®"æ‚¨è¦é¢„æµ‹å“ªäº›å˜é‡ï¼Ÿ"
    â†“
â›” é˜¶æ®µ 2: awaiting_static_selection
    â”‚  â†’ å±•ç¤ºé™æ€/æ©ç å˜é‡ï¼Œè¯¢é—®"éœ€è¦ä¿å­˜å“ªäº›ï¼Ÿä½¿ç”¨å“ªäº›æ©ç ï¼Ÿ"
    â†“
â›” é˜¶æ®µ 3: awaiting_parameters
    â”‚  â†’ è¯¢é—®"è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†åˆ’åˆ†æ¯”ä¾‹ï¼Ÿæ˜¯å¦éœ€è¦ç©ºé—´è£å‰ªï¼Ÿ"
    â†“
â›” é˜¶æ®µ 4: awaiting_execution
    â”‚  â†’ å±•ç¤ºå®Œæ•´å‚æ•°æ±‡æ€»ï¼Œç­‰å¾…"ç¡®è®¤æ‰§è¡Œ"
    â†“
âœ… æ‰§è¡Œå¤„ç† (Step A æ£€æŸ¥ â†’ Step B è½¬æ¢ â†’ Step C å¯è§†åŒ–)
    â†“
ğŸ“Š å¯é€‰ï¼šocean_forecast_statsï¼ˆper-variable NaN ç‡ã€å€¼åŸŸã€åˆ†ä½æ•°ï¼‰
    â†“
ğŸ“ è°ƒç”¨ ocean_forecast_generate_reportï¼ˆai_analysis å¿…å¡«ï¼‰ç”ŸæˆæŠ¥å‘Š
```

**Token æœºåˆ¶**ï¼šé˜¶æ®µ 4 è¿”å› `confirmation_token`ï¼Œä¸‹æ¬¡è°ƒç”¨å¿…é¡»æºå¸¦ï¼Œé˜²æ­¢è·³è¿‡é˜¶æ®µã€‚

**æŠ¥å‘Šç”Ÿæˆè¯´æ˜**ï¼šè°ƒç”¨ `ocean_forecast_generate_report` æ—¶ï¼Œ`ai_analysis` å‚æ•°å¿…é¡»ç”± Agent æ ¹æ®å¯è§†åŒ–ç»“æœå’Œå¤„ç†ç»Ÿè®¡æ’°å†™ï¼Œä¸èƒ½ç•™ç©ºã€‚åº”åŒ…å«ï¼šæ•°æ®è´¨é‡è¯„ä¼°ã€æ—¶é—´åˆ†å¸ƒåˆç†æ€§ã€æ˜¯å¦æœ‰å¼‚å¸¸å€¼ç­‰è§‚å¯Ÿã€‚

---

## å¿«é€Ÿå‚æ•°å‚è€ƒ

### ocean_forecast_preprocess_full æ ¸å¿ƒå‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `nc_folder` | string | âœ… | NC æ–‡ä»¶ç›®å½• |
| `output_base` | string | âœ… | è¾“å‡ºæ ¹ç›®å½• |
| `dyn_vars` | string[] | âœ… | é¢„æµ‹å˜é‡ï¼ˆé˜¶æ®µ 1 åå¿…å¡«ï¼‰ |
| `stat_vars` | string[] | âœ… | é™æ€å˜é‡ï¼ˆé˜¶æ®µ 2 åå¿…å¡«ï¼Œå¯ä¸º `[]`ï¼‰ |
| `mask_vars` | string[] | âœ… | æ©ç å˜é‡ï¼ˆé˜¶æ®µ 2 åå¿…å¡«ï¼Œå¯ä¸º `[]`ï¼‰ |
| `train_ratio` | number | âš ï¸ | è®­ç»ƒé›†æ¯”ä¾‹ï¼ˆé˜¶æ®µ 3 åå¿…å¡«ï¼‰ |
| `valid_ratio` | number | âš ï¸ | éªŒè¯é›†æ¯”ä¾‹ï¼ˆé˜¶æ®µ 3 åå¿…å¡«ï¼‰ |
| `test_ratio` | number | âš ï¸ | æµ‹è¯•é›†æ¯”ä¾‹ï¼ˆé˜¶æ®µ 3 åå¿…å¡«ï¼‰ |
| `user_confirmed` | boolean | âš ï¸ | é˜¶æ®µ 4 å¿…éœ€ |
| `confirmation_token` | string | âš ï¸ | é˜¶æ®µ 4 å¿…éœ€ |

### å¯é€‰å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `h_slice` | - | H æ–¹å‘è£å‰ªï¼Œå¦‚ `"0:512"` |
| `w_slice` | - | W æ–¹å‘è£å‰ªï¼Œå¦‚ `"0:1024"` |
| `use_date_filename` | `true` | ç”¨æ—¥æœŸå‘½åæ–‡ä»¶ |
| `date_format` | `auto` | `auto`/`YYYYMMDD`/`YYYYMMDDHH`/`YYYYMMDDHHmm` |
| `time_var` | è‡ªåŠ¨æ£€æµ‹ | æ—¶é—´å˜é‡åï¼ˆè‡ªåŠ¨æ£€æµ‹ time/ocean_time ç­‰ï¼‰ |
| `chunk_size` | `200` | æ‰¹å¤„ç†æ–‡ä»¶æ•°ï¼ˆæ§åˆ¶å†…å­˜ï¼‰ |
| `max_files` | æ— é™åˆ¶ | æœ€å¤šå¤„ç†æ–‡ä»¶æ•°ï¼ˆè°ƒè¯•ç”¨ï¼‰ |
| `skip_visualize` | `false` | è·³è¿‡å¯è§†åŒ–æ­¥éª¤ |

---

## ç¦æ­¢è¡Œä¸º

| ç±»åˆ« | ç¦æ­¢è¡Œä¸º |
|------|----------|
| **å˜é‡é€‰æ‹©** | è‡ªåŠ¨å†³å®š dyn_vars / stat_vars / mask_vars |
| **å‚æ•°å†³ç­–** | è‡ªåŠ¨å†³å®šåˆ’åˆ†æ¯”ä¾‹ã€è£å‰ªèŒƒå›´ |
| **æµç¨‹æ§åˆ¶** | è·³è¿‡ç¡®è®¤é˜¶æ®µã€è·³è¿‡æŠ¥å‘Šç”Ÿæˆ |
| **é”™è¯¯å¤„ç†** | è‡ªåŠ¨é‡è¯•ã€è‡ªåŠ¨æ›´æ¢è·¯å¾„ |

---

## å®Œæ•´å·¥ä½œæµç¨‹

```
1. æ”¶é›†ä¿¡æ¯ â†’ æ•°æ®ç›®å½•ã€è¾“å‡ºç›®å½•
2. åˆ†ææ•°æ® â†’ ocean_forecast_preprocess_fullï¼ˆè§¦å‘ Step A æ£€æŸ¥ï¼‰
3. ç”¨æˆ·é€‰æ‹© â†’ é¢„æµ‹å˜é‡ã€é™æ€å˜é‡ã€æ©ç å˜é‡
4. ç¡®è®¤å‚æ•° â†’ åˆ’åˆ†æ¯”ä¾‹ã€å¯é€‰ç©ºé—´è£å‰ª
5. æ‰§è¡Œå‰ç¡®è®¤ â†’ å±•ç¤ºæ‰€æœ‰å‚æ•°ï¼Œç­‰å¾…"ç¡®è®¤æ‰§è¡Œ"
6. æ‰§è¡Œå¤„ç† â†’ ocean_forecast_preprocess_full (user_confirmed=true)
7. æ•°æ®è´¨é‡é‡åŒ–ï¼ˆå¯é€‰ï¼‰â†’ ocean_forecast_statsï¼ˆNaN ç‡ã€å€¼åŸŸç»Ÿè®¡ï¼‰
8. ç”ŸæˆæŠ¥å‘Š â†’ ocean_forecast_generate_report + Agent å¡«å†™åˆ†æ
```

---

## å‚è€ƒæ–‡æ¡£ç´¢å¼•

è¯¦ç»†ä¿¡æ¯è¯·æŒ‰éœ€è¯»å–ä»¥ä¸‹æ–‡æ¡£ï¼š

| æ–‡æ¡£ | å†…å®¹ | ä½•æ—¶è¯»å– |
|------|------|----------|
| `references/workflow-detail.md` | 4 é˜¶æ®µæµç¨‹è¯¦è§£ | éœ€è¦äº†è§£å®Œæ•´æµç¨‹æ—¶ |
| `references/examples.md` | å¯¹è¯ç¤ºä¾‹ | éœ€è¦å‚è€ƒç¤ºä¾‹æ—¶ |
| `references/parameters.md` | æ‰€æœ‰å·¥å…·å‚æ•° | éœ€è¦å‚æ•°ç»†èŠ‚æ—¶ |
| `references/errors.md` | é”™è¯¯å¤„ç†æŒ‡å— | é‡åˆ°é”™è¯¯æ—¶ |
| `references/warnings.md` | è­¦å‘Šå¤„ç†æŒ‡å— | é‡åˆ°è­¦å‘Šæ—¶ |

---

## è¾“å‡ºç›®å½•ç»“æ„

```
output_base/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ {var}/      â† æ¯ä¸ªé¢„æµ‹å˜é‡ä¸€ä¸ªç›®å½•
â”‚   â”‚   â”œâ”€â”€ 20200101.npy   â† æŒ‰æ—¶é—´å‡åºï¼Œæ–‡ä»¶åä¸ºæ—¥æœŸ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ valid/
â”œâ”€â”€ test/
â”œâ”€â”€ static_variables/       â† é™æ€å˜é‡ï¼ˆåæ ‡ï¼‰å’Œæ©ç 
â”œâ”€â”€ time_index.json         â† å®Œæ•´æ—¶é—´æˆ³æº¯æº
â”œâ”€â”€ var_names.json          â† å˜é‡é…ç½®ï¼ˆä¾› DataLoader ä½¿ç”¨ï¼‰
â”œâ”€â”€ data_stats.json         â† per-variable ç»Ÿè®¡é‡ï¼ˆocean_forecast_stats ç”Ÿæˆï¼‰
â”œâ”€â”€ preprocess_manifest.json
â”œâ”€â”€ visualisation_forecast/ â† å¯è§†åŒ–å›¾ç‰‡
â”‚   â”œâ”€â”€ train/
â”‚   â”‚   â”œâ”€â”€ {var}_frames.png        â† 4 å¸§ç©ºé—´åˆ†å¸ƒå›¾
â”‚   â”‚   â”œâ”€â”€ {var}_timeseries.png    â† æ—¶åºå‡å€¼/æ ‡å‡†å·®å›¾
â”‚   â”‚   â””â”€â”€ {var}_distribution.png â† å€¼åŸŸåˆ†å¸ƒç›´æ–¹å›¾ï¼ˆå« P5/P95ï¼‰
â”‚   â””â”€â”€ ...
â””â”€â”€ preprocessing_report.md
```
