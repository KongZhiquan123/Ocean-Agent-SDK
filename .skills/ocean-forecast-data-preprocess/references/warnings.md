# è­¦å‘Šå¤„ç†æŒ‡å—

> ç‰ˆæœ¬: 1.3.0 | æœ€åŽæ›´æ–°: 2026-02-26

æœ¬æ–‡æ¡£è¯´æ˜Žé¢„å¤„ç†è¿‡ç¨‹ä¸­çš„è­¦å‘ŠåŠå¤„ç†æ–¹æ³•ã€‚

---

## è­¦å‘Šç±»åž‹ä¸€è§ˆ

| è­¦å‘Šç±»åž‹ | æ¥æºå·¥å…· | è¯´æ˜Ž | æ˜¯å¦é˜»æ–­ |
|----------|----------|------|----------|
| `nan_detected` | preprocess_full | æ•°æ®ä¸­å­˜åœ¨ NaN | ä»…æç¤ºï¼ˆæµ·æ´‹æ•°æ®æ­£å¸¸ï¼‰ |
| `high_nan_rate` | forecast_stats | æŸå˜é‡ NaN çŽ‡ > 30% | éœ€ç”¨æˆ·ç¡®è®¤ |
| `time_leakage` | forecast_stats | train/valid/test æ—¶é—´è¾¹ç•Œé‡å  | **å¼ºåˆ¶é˜»æ–­** |
| `cross_split_mean` | forecast_stats | å‡å€¼åç§» > 1Ïƒ | éœ€ç”¨æˆ·ç¡®è®¤ |
| `cross_split_std` | forecast_stats | æ–¹å·®æ¯” > 2x æˆ– < 0.5x | éœ€ç”¨æˆ·ç¡®è®¤ |
| `time_gap_detected` | preprocess_full | æ—¶é—´åºåˆ—å­˜åœ¨é—´éš” | éœ€ç”¨æˆ·ç¡®è®¤ |
| `time_order_warning` | preprocess_full | æ—¶é—´æŽ’åºå­˜åœ¨å¼‚å¸¸æ–‡ä»¶ | éœ€ç”¨æˆ·ç¡®è®¤ |
| `missing_mask` | preprocess_full | æœªæ£€æµ‹åˆ°æŽ©ç å˜é‡ | éœ€ç”¨æˆ·ç¡®è®¤ |
| `large_dataset` | preprocess_full | æ•°æ®é‡è¾ƒå¤§ | ä»…æç¤º |
| `small_split` | preprocess_full | æŸä¸ªæ•°æ®é›†åˆ’åˆ†è¿‡å° | éœ€ç”¨æˆ·ç¡®è®¤ |

---

## NaN ç›¸å…³è­¦å‘Š

### nan_detected

**è­¦å‘Šä¿¡æ¯**ï¼š`æ•°æ®ä¸­æ£€æµ‹åˆ° NaN å€¼`ï¼ˆæ¥è‡ª preprocess_fullï¼‰

**è¯¦æƒ…**ï¼š
```
åœ¨ä»¥ä¸‹å˜é‡ä¸­æ£€æµ‹åˆ° NaN å€¼ï¼š
- sst: 12.3% NaNï¼ˆä¸»è¦åˆ†å¸ƒåœ¨è¾¹ç•Œ/é™†åœ°åŒºåŸŸï¼‰
- ssh: 8.7% NaN

NaN é€šå¸¸è¡¨ç¤ºï¼š
1. é™†åœ°åŒºåŸŸï¼ˆè¢«æŽ©ç è¦†ç›–ï¼Œæ­£å¸¸ï¼‰
2. è§‚æµ‹ç¼ºå¤±
3. æ— æ•ˆæ•°æ®
```

**å¤„ç†**ï¼šå¯¹äºŽæµ·æ´‹æ•°æ®ï¼Œé™†åœ°åŒºåŸŸçš„ NaN æ˜¯æ­£å¸¸çš„ï¼Œæ— éœ€å¹²é¢„ã€‚å¦‚æžœ NaN åˆ†å¸ƒå¼‚å¸¸ï¼ˆå¦‚éšæœºåˆ†æ•£åœ¨æµ·æ´‹åŒºåŸŸï¼‰ï¼Œæç¤ºç”¨æˆ·æ³¨æ„ã€‚

---

### high_nan_rate

**è­¦å‘Šä¿¡æ¯**ï¼š`{var}/{split} NaN çŽ‡ XX% åé«˜`ï¼ˆæ¥è‡ª ocean_forecast_preprocess_statsï¼‰

**è§¦å‘æ¡ä»¶**ï¼šæŸå˜é‡åœ¨æŸ split ä¸­çš„ NaN å æ¯”è¶…è¿‡ 30%ã€‚

**è¯¦æƒ…**ï¼š
```
ocean_forecast_preprocess_stats ç»Ÿè®¡å‘çŽ°ï¼š
- sst/valid: NaN çŽ‡ 35.0%ï¼ˆè¶…è¿‡ 30% é˜ˆå€¼ï¼‰

å¯èƒ½åŽŸå› ï¼š
1. è¯¥ split æ—¶é—´æ®µå¯¹åº”å¤§èŒƒå›´é™†åœ°è¦†ç›–ï¼ˆæ­£å¸¸ï¼‰
2. æ•°æ®æ–‡ä»¶æŸåæˆ–è½¬æ¢å¼‚å¸¸
3. æŽ©ç å˜é‡æœªæ­£ç¡®åº”ç”¨
```

**å¤„ç†é€‰é¡¹**ï¼š
```
âš ï¸ è­¦å‘Šï¼šsst/valid NaN çŽ‡ 35.0% åé«˜

ã€å¯èƒ½åŽŸå› ã€‘
1. é™†åœ°åŒºåŸŸå æ¯”è¾ƒé«˜ï¼ˆå¯¹äºŽæµ·å²¸æ•°æ®é›†å±žæ­£å¸¸ï¼‰
2. æ•°æ®æ–‡ä»¶å­˜åœ¨æŸå

ã€å¤„ç†é€‰é¡¹ã€‘
1. ç¡®è®¤æ­£å¸¸ï¼Œç»§ç»­ç”ŸæˆæŠ¥å‘Šï¼ˆé€‚ç”¨äºŽå«å¤§é‡é™†åœ°åŒºåŸŸçš„æ•°æ®é›†ï¼‰
2. æŸ¥çœ‹åˆ†å¸ƒç›´æ–¹å›¾ç¡®è®¤ï¼ˆæ£€æŸ¥ {var}_distribution.png åˆ¤æ–­åˆ†å¸ƒæ˜¯å¦åˆç†ï¼‰
3. åœæ­¢ï¼Œæ£€æŸ¥åŽŸå§‹æ•°æ®ï¼ˆé€‚ç”¨äºŽ NaN åˆ†å¸ƒéšæœºã€æ€€ç–‘æ•°æ®æŸåï¼‰

è¯·é€‰æ‹©æˆ–å‘Šè¯‰æˆ‘æ‚¨çš„å†³å®šã€‚
```

---

## æ—¶é—´æ³„éœ²è­¦å‘Š

### time_leakage

**è­¦å‘Šä¿¡æ¯**ï¼š`[æ—¶é—´è¾¹ç•Œ] æ—¶é—´æ³„éœ²é£Žé™©: train ç»“æŸ XXXXXX â‰¥ valid å¼€å§‹ XXXXXX`ï¼ˆæ¥è‡ª ocean_forecast_preprocess_statsï¼‰

**è§¦å‘æ¡ä»¶**ï¼š`time_boundary_check.passed = false`ï¼Œå³æŸç›¸é‚» split å¯¹çš„æ—¶é—´æ®µå­˜åœ¨é‡å ã€‚

**ä¸¥é‡æ€§**ï¼š**å¼ºåˆ¶é˜»æ–­** â€” æ—¶é—´æ³„éœ²å¯¼è‡´è®­ç»ƒé›†"çœ‹åˆ°"æœªæ¥æ•°æ®ï¼Œæ¨¡åž‹è¯„ä¼°å®Œå…¨å¤±æ•ˆã€‚

**è¯¦æƒ…**ï¼š
```
time_boundary_check å‘çŽ°ï¼š
- train ç»“æŸæ—¶é—´: 20220101000000
- valid å¼€å§‹æ—¶é—´: 20211201000000
- ç»“è®º: train ç»“æŸ â‰¥ valid å¼€å§‹ï¼Œå­˜åœ¨çº¦ 1 ä¸ªæœˆé‡å 
```

**å¤„ç†**ï¼š
```
ðŸš¨ ä¸¥é‡è­¦å‘Šï¼šæ£€æµ‹åˆ°æ—¶é—´æ³„éœ²ï¼

train ç»“æŸ: 2022-01-01
valid å¼€å§‹: 2021-12-01
ä¸¤è€…å­˜åœ¨çº¦ 1 ä¸ªæœˆçš„æ—¶é—´é‡å ã€‚

è®­ç»ƒé›†åŒ…å«äº†éªŒè¯é›†çš„æ•°æ®ï¼Œæ¨¡åž‹è¯„ä¼°ç»“æžœä¸å¯ä¿¡ã€‚

ã€å¤„ç†æ–¹æ¡ˆã€‘
å¿…é¡»é‡æ–°æ‰§è¡Œé¢„å¤„ç†ï¼Œè°ƒæ•´ train_ratio / valid_ratio / test_ratioï¼Œ
ç¡®ä¿ train ç»“æŸæ—¶é—´ < valid å¼€å§‹æ—¶é—´ < test å¼€å§‹æ—¶é—´ã€‚

æ˜¯å¦é‡æ–°æ‰§è¡Œï¼Ÿè¯·æä¾›æ–°çš„åˆ’åˆ†æ¯”ä¾‹ã€‚
```

---

## åˆ†å¸ƒä¸€è‡´æ€§è­¦å‘Š

### cross_split_mean

**è­¦å‘Šä¿¡æ¯**ï¼š`{var}/{split} å‡å€¼åç§» X.XXÏƒ (train=..., {split}=...)`ï¼ˆæ¥è‡ª ocean_forecast_preprocess_statsï¼‰

**è§¦å‘æ¡ä»¶**ï¼š`|split_mean - train_mean| / train_std > 1.0`ï¼ˆå‡å€¼åç§»è¶…è¿‡ 1 ä¸ªè®­ç»ƒæ ‡å‡†å·®ï¼‰ã€‚

**è¯¦æƒ…**ï¼š
```
cross_split_check å‘çŽ° sst/test å‡å€¼åç§»ï¼š
- train å‡å€¼: 15.3Â°Cï¼Œtrain æ ‡å‡†å·®: 8.2Â°C
- test  å‡å€¼: 23.7Â°C
- åç§»é‡: +8.4Â°Cï¼ˆ1.02Ïƒï¼Œè¶…è¿‡ 1.0Ïƒ é˜ˆå€¼ï¼‰
```

**å¤„ç†é€‰é¡¹**ï¼š
```
âš ï¸ è­¦å‘Šï¼šsst/test å‡å€¼åç§» 1.02Ïƒ

ã€å¯èƒ½åŽŸå› ã€‘
1. å­£èŠ‚æ€§å·®å¼‚ï¼ˆæµ‹è¯•é›†é›†ä¸­åœ¨å¤å­£ï¼Œè®­ç»ƒé›†è·¨å…¨å¹´ï¼‰â†’ æ­£å¸¸
2. æµ‹è¯•é›†æ—¶é—´æ®µå¯¹åº”å¼‚å¸¸æ°”å€™äº‹ä»¶ï¼ˆåŽ„å°”å°¼è¯ºç­‰ï¼‰â†’ éœ€æ³¨æ„
3. æ•°æ®åˆ’åˆ†åˆ‡å‰²äº†å­£èŠ‚å‘¨æœŸï¼Œå¯¼è‡´åˆ†å¸ƒä¸å‡è¡¡

ã€å»ºè®®ã€‘
- æŸ¥çœ‹æ—¶åºå›¾å¯¹æ¯” train/test çš„å‡å€¼æ›²çº¿
- è‹¥å±žå­£èŠ‚æ€§å·®å¼‚ï¼Œæ­£å¸¸ï¼Œç»§ç»­ç”ŸæˆæŠ¥å‘Š
- è‹¥éžå­£èŠ‚æ€§ï¼Œè€ƒè™‘è°ƒæ•´åˆ’åˆ†æ¯”ä¾‹ä½¿å„é›†åˆè¦†ç›–å®Œæ•´å¹´ä»½

è¯·ç¡®è®¤åŽç»§ç»­ï¼Œæˆ–å‘Šè¯‰æˆ‘æ˜¯å¦éœ€è¦é‡æ–°åˆ’åˆ†ã€‚
```

### cross_split_std

**è­¦å‘Šä¿¡æ¯**ï¼š`{var}/{split} æ–¹å·®æ¯” X.XXx (train_std=..., {split}_std=...)`ï¼ˆæ¥è‡ª ocean_forecast_preprocess_statsï¼‰

**è§¦å‘æ¡ä»¶**ï¼š`split_std / train_std > 2.0` æˆ– `< 0.5`

**å¤„ç†**ï¼šå±•ç¤ºç»™ç”¨æˆ·ï¼ŒåŽŸå› é€šå¸¸æ˜¯æµ‹è¯•é›†æ—¶æ®µå˜çŽ‡å¼‚å¸¸ï¼ˆæžç«¯å¤©æ°”/å¹³é™æœŸï¼‰ï¼Œè¯·ç”¨æˆ·åˆ¤æ–­æ˜¯å¦åˆç†ã€‚

---

## æ—¶é—´åºåˆ—ç›¸å…³è­¦å‘Š

### time_gap_detected

**è­¦å‘Šä¿¡æ¯**ï¼š`æ—¶é—´åºåˆ—å­˜åœ¨é—´éš”ï¼ˆGapï¼‰`

**è¯¦æƒ…**ï¼š
```
æ£€æµ‹åˆ°æ—¶é—´åºåˆ—ä¸è¿žç»­ï¼š
- æœŸæœ›æ­¥é•¿ï¼š1 å¤©
- æ£€æµ‹åˆ°é—´éš”ï¼š2020-06-15 â†’ 2020-06-20ï¼ˆç¼ºå°‘ 4 å¤©ï¼‰
- é—´éš”æ•°é‡ï¼š3 å¤„
- å½±å“èŒƒå›´ï¼šå…±ç¼ºå¤± 12 ä¸ªæ—¶é—´æ­¥
```

**å¤„ç†é€‰é¡¹**ï¼š
```
æ—¶é—´åºåˆ—å­˜åœ¨é—´éš”ï¼Œè¯·é€‰æ‹©å¤„ç†æ–¹å¼ï¼š

1. ç»§ç»­å¤„ç†ï¼ˆä¿ç•™é—´éš”ï¼Œæ—¶é—´ç´¢å¼•è®°å½•åœ¨ time_index.jsonï¼Œé€‚ç”¨äºŽé—´éš”è¾ƒå°‘æˆ–è®­ç»ƒæ—¶æœ‰å¡«å……ç­–ç•¥ï¼‰
2. åœæ­¢å¹¶æ£€æŸ¥æ•°æ®ï¼ˆå…ˆç¡®è®¤åŽŸå§‹æ•°æ®å®Œæ•´æ€§ï¼Œé€‚ç”¨äºŽé—´éš”è¾ƒå¤šã€å½±å“åºåˆ—å› æžœå…³ç³»ï¼‰

è¯·é€‰æ‹©æˆ–å‘Šè¯‰æˆ‘æ‚¨çš„å†³å®šã€‚
```

### time_order_warning

**è­¦å‘Šä¿¡æ¯**ï¼š`éƒ¨åˆ† NC æ–‡ä»¶æ—¶é—´æˆ³ä¸Žæ–‡ä»¶åä¸ä¸€è‡´`

**è¯¦æƒ…**ï¼š
```
æ£€æµ‹åˆ°ä»¥ä¸‹æ–‡ä»¶çš„å†…éƒ¨æ—¶é—´æˆ³ä¸Žæ–‡ä»¶åä¸ä¸€è‡´ï¼š
- 20200301.nc â†’ å†…éƒ¨æ—¶é—´: 2020-03-02

å¤„ç†æ–¹å¼ï¼šä»¥ NC æ–‡ä»¶å†…éƒ¨æ—¶é—´å˜é‡ä¸ºå‡†è¿›è¡ŒæŽ’åºã€‚
```

**å¤„ç†**ï¼šå±•ç¤ºç»™ç”¨æˆ·ï¼Œç¡®è®¤ä»¥å†…éƒ¨æ—¶é—´å˜é‡æŽ’åºï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œä¸éœ€è¦ç”¨æˆ·å¹²é¢„ï¼Œä»…ä½œä¿¡æ¯æç¤ºã€‚

---

## æŽ©ç ç›¸å…³è­¦å‘Š

### missing_mask

**è­¦å‘Šä¿¡æ¯**ï¼š`æœªæ£€æµ‹åˆ°æŽ©ç å˜é‡`

**è¯¦æƒ…**ï¼š
```
åœ¨æ•°æ®ä¸­æœªæ£€æµ‹åˆ°æŽ©ç å˜é‡ï¼ˆå¦‚ maskã€land_sea_maskï¼‰ã€‚

å¯¹äºŽé¢„æµ‹æ¨¡åž‹ï¼š
- æ— æŽ©ç æ—¶ï¼Œé™†åœ°åŒºåŸŸçš„ NaN å€¼ä¼šç›´æŽ¥ä¼ å…¥æ¨¡åž‹
- å¯èƒ½å½±å“æŸå¤±å‡½æ•°è®¡ç®—å’Œè®­ç»ƒæ•ˆæžœ
```

**å¤„ç†é€‰é¡¹**ï¼š
```
è¯·é€‰æ‹©ï¼š

1. ä¸ä½¿ç”¨æŽ©ç ï¼ˆmask_vars: []ï¼‰â€” å°†æ‰€æœ‰æ•°æ®è§†ä¸ºæœ‰æ•ˆï¼Œé€‚ç”¨äºŽæ¨¡åž‹å†…éƒ¨å¤„ç† NaN
2. ä»Ž NaN è‡ªåŠ¨ç”ŸæˆæŽ©ç  â€” ä»¥é¦–ä¸ªæ—¶é—´æ­¥çš„ NaN åˆ†å¸ƒä½œä¸ºæµ·é™†æŽ©ç ï¼Œé€‚ç”¨äºŽé™†åœ°åŒºåŸŸç¨³å®šä¸º NaN
3. æ‰‹åŠ¨æŒ‡å®šæŽ©ç å˜é‡ â€” æŸ¥çœ‹æ‰€æœ‰å˜é‡åŽé€‰æ‹©åˆé€‚çš„æŽ©ç 
```

---

## æ•°æ®é›†åˆ’åˆ†è­¦å‘Š

### small_split

**è­¦å‘Šä¿¡æ¯**ï¼š`æµ‹è¯•é›†æ—¶é—´æ­¥æ•°è¿‡å°‘`

**è¯¦æƒ…**ï¼š
```
å½“å‰åˆ’åˆ†æ–¹æ¡ˆï¼š
  è®­ç»ƒé›†ï¼š900 æ­¥ï¼ˆ82%ï¼‰
  éªŒè¯é›†ï¼š100 æ­¥ï¼ˆ9%ï¼‰
  æµ‹è¯•é›†ï¼š95 æ­¥ï¼ˆ9%ï¼‰â† âš ï¸ è¾ƒå°‘

å¯¹äºŽæ—¶åºé¢„æµ‹ï¼Œå»ºè®®æµ‹è¯•é›†è‡³å°‘åŒ…å« 100 ä¸ªæ—¶é—´æ­¥ï¼Œ
ä»¥è¦†ç›–è¶³å¤Ÿçš„é¢„æµ‹è¯„ä¼°æ ·æœ¬ã€‚
```

**å¤„ç†**ï¼š
```
å½“å‰æµ‹è¯•é›†åªæœ‰ 95 ä¸ªæ—¶é—´æ­¥ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ

å»ºè®®è°ƒæ•´æ¯”ä¾‹ï¼Œä¾‹å¦‚ï¼š0.7 / 0.1 / 0.2

æˆ–è€…å¦‚æžœæ‚¨ç¡®è®¤å½“å‰æ¯”ä¾‹åˆé€‚ï¼Œè¯·å›žå¤"ç»§ç»­"ã€‚
```

---

## æ€§èƒ½æç¤º

### large_dataset

**æç¤ºä¿¡æ¯**ï¼š`æ•°æ®é‡è¾ƒå¤§ï¼Œå¤„ç†å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´`

**è¯¦æƒ…**ï¼š
```
æ•°æ®ç»Ÿè®¡ï¼š
- æ–‡ä»¶æ•°é‡ï¼š5000+ ä¸ª
- é¢„æµ‹å˜é‡æ•°ï¼š3 ä¸ª
- é¢„è®¡å¤„ç†æ—¶é—´ï¼šè¾ƒé•¿ï¼ˆ20-60 åˆ†é’Ÿï¼‰
- é¢„è®¡è¾“å‡ºå¤§å°ï¼šçº¦ 15GB

å»ºè®®ï¼š
- ç¡®ä¿ç£ç›˜ç©ºé—´å……è¶³ï¼ˆè¾“å‡ºå¤§å°çº¦ç­‰äºŽåŽŸå§‹ NC å¤§å°ï¼‰
- å¤„ç†è¿‡ç¨‹ä¸­è¯·å‹¿ä¸­æ–­
- å¯è®¾ç½® chunk_size=100 é™ä½Žå†…å­˜å ç”¨
```

---

## è­¦å‘Šå¤„ç†åŽŸåˆ™

1. **å¼ºåˆ¶é˜»æ–­è­¦å‘Š**ï¼šå¿…é¡»åœæ­¢ï¼Œç­‰å¾…ç”¨æˆ·å¤„ç†åŽé‡æ–°æ‰§è¡Œ
   - `time_leakage`ï¼ˆæ—¶é—´æ³„éœ²ï¼Œæ•°æ®æ— æ•ˆï¼‰

2. **é˜»æ–­æ€§è­¦å‘Š**ï¼šå¿…é¡»å±•ç¤ºç»™ç”¨æˆ·å¹¶ç­‰å¾…ç¡®è®¤
   - `time_gap_detected`
   - `missing_mask`
   - `small_split`
   - `high_nan_rate`
   - `cross_split_mean` / `cross_split_std`

3. **éžé˜»æ–­æ€§è­¦å‘Š**ï¼šå±•ç¤ºåŽç»§ç»­æ‰§è¡Œ
   - `nan_detected`ï¼ˆæµ·æ´‹æ•°æ®æ­£å¸¸çŽ°è±¡ï¼‰
   - `time_order_warning`ï¼ˆå·¥å…·å·²å¤„ç†ï¼‰
   - `large_dataset`ï¼ˆæ€§èƒ½æç¤ºï¼‰

4. **è­¦å‘Šå±•ç¤ºæ ¼å¼**ï¼š
```
âš ï¸ è­¦å‘Šï¼š[è­¦å‘Šç±»åž‹]

ã€è¯¦æƒ…ã€‘
...

ã€å¤„ç†é€‰é¡¹ã€‘
1. ...
2. ...

è¯·é€‰æ‹©æˆ–å‘Šè¯‰æˆ‘æ‚¨çš„å†³å®šã€‚
```
